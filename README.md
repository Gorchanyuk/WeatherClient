# WeatherClient

## Запуск приложения:

**Для запуска и остановки приложения необходимо иметь установленный на компьтер Docker**
* Откройте командную строку или терминал и перейдите в директорию ...\WeatherClient.
* Запустите следующую команду: `docker-compose up`

## Остановка приложения:
* Откройте командную строку или терминал и перейдите в директорию ...\WeatherClient.
* Запустите следующую команду: `docker compose down -v`

## Структура БД
![схема приложения](https://github.com/Gorchanyuk/WeatherClient/blob/master/docs/%D0%A1%D1%85%D0%B5%D0%BC%D0%B0%20%D0%91%D0%94.jpg?raw=true)

## Используемые технологии
* язык программирования: **Java**
* База данных: PostgreSQL

В данном приложение используется фреймворк Spring Boot, а именно модули spring-boot-starter-data-jpa и spring-cloud-starter-openfeign.
Spring является самым популярным фреймворком для java и позволяет значительно ускорить разработку приложений за счет автоматизации многих рутинных задач. Он предоставляет широкий набор инструментов и функциональности, которые упрощают разработку и поддержку софта.

Благодаря своей популярности и активному сообществу разработчиков, Spring имеет обширную документацию, богатый выбор сторонних библиотек и поддержку для множества интеграций с другими технологиями и фреймворками. Это делает его отличным выбором для разработки масштабируемых и гибких приложений.

## Описание работы приложения

Данное приложение осуществляет получение данных о погоде с сайта https://openweathermap.org/. При запуске приложения происходит автоматическая генерация таблиц БД и наполнение таблиц **country** и **city** с помощью библиотеки liquebase. 
В таблицу **city** заносятся данные только о названии города и ссылка на поле страны из таблицы **country**.

Данные о 50 крупнейших городах взяты от сюда: https://en.wikipedia.org/wiki/List_of_largest_cities.


При запуске программы происходит обращение к БД, на получение списка всех городов. После этого происходит проверка указанны ли географические координаты, если координаты указаны то происходит обращение 
к ресурсу `https://api.openweathermap.org/data/2.5/weather?lat={lat}&lon={lon}&appid={API key}` - для получения сведений о погоде. 
Если координаты не указаны, то сперва происходит обращение к ресурсу `http://api.openweathermap.org/geo/1.0/direct?q={city name},{state code}&appid={API key}` - для получения координат города. В случае если название города указанно не корректно, программа продолжит работать и выведет лог об ошибке.
В случае если в БД были занесены некорректные данные координат города, то программа также продолжит работу, но сообщит об ошибке с помощью логов.

Получение данных о погоде осуществляется по расписанию. На данный момент запрос осуществляется ровно в 00 минут каждый час.

Обращения к БД оптимизированны. Вставка новых записей о погоде осуществляется пакетами. Запись данных о полученных координатах было решено оставить по 1 записи, так как это происходит лишь 1 раз и не несет нагрузки.

При проверке работы приложения могут возникнуть проблемы из за ограниченного лимита сообщений в минуту (60 шт.) и в день (1000 шт.), для решения проблемы следует в переменных средах задать переменную OPENWEATHERMAP_KEY и задать ей значение вашего ключа для сайта https://openweathermap.org/
или в файле aplication.properties заменить значение свойства props.openweathermap.key на свой ключ.

При реализации этого тестового задания, для ускорения разработки и предоставления результата были опущены:
* покрытие приложения тестами
* покрытие приложения логами
* обработка всех возможных исключений
